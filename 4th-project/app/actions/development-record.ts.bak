'use server';

import DevelopmentService from '@/services/development-service';
import { 
  CreateDevelopmentRecordRequest,
  UpdateDevelopmentRecordRequest,
  DevelopmentRecord,
  DevelopmentRecordsParams 
} from '@/types/development';

/**
 * ë°œë‹¬ ê¸°ë¡ ì €ì¥
 */
export async function saveDevelopmentRecord(data: CreateDevelopmentRecordRequest): Promise<string> {
  try {
    const record = await DevelopmentService.createRecord(data);
    console.log('ğŸ” ë°œë‹¬ ê¸°ë¡ ì €ì¥ ê²°ê³¼:', record);
    return record.id;
  } catch (error) {
    console.error('ë°œë‹¬ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:', error);
    throw new Error('ë°œë‹¬ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨');
  }
}

/**
 * ë°œë‹¬ ê¸°ë¡ ëª©ë¡ ì¡°íšŒ
 */
export async function getDevelopmentRecords(params: DevelopmentRecordsParams = {}): Promise<DevelopmentRecord[]> {
  try {
    const response = await DevelopmentService.getRecords(params);
    return response.results;
  } catch (error) {
    console.error('Error getting development records:', error);
    throw new Error('Failed to get development records');
  }
}

/**
 * ë°œë‹¬ ê¸°ë¡ ìƒì„¸ ì¡°íšŒ
 */
export async function getDevelopmentRecord(id: string): Promise<DevelopmentRecord | null> {
  try {
    return await DevelopmentService.getRecord(id);
  } catch (error) {
    console.error('Error getting development record:', error);
    return null;
  }
}

/**
 * ë°œë‹¬ ê¸°ë¡ ìˆ˜ì •
 */
export async function updateDevelopmentRecord(
  id: string, 
  data: UpdateDevelopmentRecordRequest
): Promise<boolean> {
  try {
    await DevelopmentService.updateRecord(id, data);
    return true;
  } catch (error) {
    console.error('Error updating development record:', error);
    throw new Error('Failed to update development record');
  }
}

/**
 * ë°œë‹¬ ê¸°ë¡ ì‚­ì œ
 */
export async function deleteDevelopmentRecord(id: string): Promise<boolean> {
  try {
    await DevelopmentService.deleteRecord(id);
    return true;
  } catch (error) {
    console.error('Error deleting development record:', error);
    throw new Error('Failed to delete development record');
  }
}

/**
 * ë°œë‹¬ ê¸°ë¡ í†µê³„ ì¡°íšŒ
 */
export async function getDevelopmentStats(childId?: string) {
  try {
    return await DevelopmentService.getStats({ childId });
  } catch (error) {
    console.error('Error getting development stats:', error);
    throw new Error('Failed to get development stats');
  }
}

/**
 * ë°œë‹¬ ì •ë³´ ê²€ìƒ‰
 */
export async function searchDevelopmentInfo(query: string) {
  try {
    return await DevelopmentService.searchDevelopmentInfo(query);
  } catch (error) {
    console.error('Error searching development info:', error);
    throw new Error('Failed to search development info');
  }
}

/**
 * ë°œë‹¬ ì´ì •í‘œ ëª©ë¡ ì¡°íšŒ
 */
export async function getDevelopmentMilestones(params: { ageGroup?: string; developmentArea?: string } = {}) {
  try {
    return await DevelopmentService.getMilestones(params);
  } catch (error) {
    console.error('Error getting development milestones:', error);
    throw new Error('Failed to get development milestones');
  }
}

/**
 * ìë…€ë³„ ë‹¬ì„± ì´ì •í‘œ ì¡°íšŒ
 */
export async function getChildMilestones(childId: string) {
  try {
    return await DevelopmentService.getChildMilestones({ childId });
  } catch (error) {
    console.error('Error getting child milestones:', error);
    throw new Error('Failed to get child milestones');
  }
}

/**
 * ìë…€ ì´ì •í‘œ ë‹¬ì„± ê¸°ë¡
 */
export async function createChildMilestone(data: {
  childId: string;
  milestoneId: string;
  achievedDate: string;
  notes?: string;
}) {
  try {
    return await DevelopmentService.createChildMilestone(data);
  } catch (error) {
    console.error('Error creating child milestone:', error);
    throw new Error('Failed to create child milestone');
  }
}

/**
 * ì´ì •í‘œ ë‹¬ì„± ì§„ë„ ì¡°íšŒ
 */
export async function getMilestoneProgress(childId?: string) {
  try {
    return await DevelopmentService.getMilestoneProgress(childId);
  } catch (error) {
    console.error('Error getting milestone progress:', error);
    throw new Error('Failed to get milestone progress');
  }
}
